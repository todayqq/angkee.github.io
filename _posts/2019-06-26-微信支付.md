---
layout:     post                    # 使用的布局（不需要改）
title:      微信支付               # 标题 
subtitle:    #副标题
date:       2019-06-26              # 时间
author:     Angkee                      # 作者
header-img:    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - PHP
---

![微信支付时序图](https://pay.weixin.qq.com/wiki/doc/api/img/chapter7_4_1.png)

1. 商户后台系统根据用户购买的商品生成商品订单
2. 商户根据商品订单信息，调用微信下单 API
3. 微信支付系统接收到请求之后生成预付交易订单
4. 商户后台系统拿到预付订单信息后，通知用户支付
5. 用户点击发起支付请求，微信支付系统收到请求后，要求用户授权
6. 用户输入支付密码，确认之后后提交支付授权
7. 微信支付系统验证授权，完整支付交易
8. 微信支付系统完成支付后，异步通知商户后台系统支付结果，且并行将交易结果通过微信消息发送到微信客户端
9. 商户后台系统受到支付结果后通知微信支付系统处理结果，微信支付系统不会再发送次订单的支付通知
10. 如果商户后台系统没有收到支付通知，可以通过主动查询订单 API，来查询支付结果

图片和整个支付流程很容易遗忘，所以需要记住几个关键词

- 关键词

订单、预付单、支付且授权、并行通知买家和卖家支付结果

- Demo 示例

[SDK与DEMO下载](https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=11_1)